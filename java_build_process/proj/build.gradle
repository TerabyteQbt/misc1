apply plugin: 'java'

dependencies {
    compile fileTree(dir: "$System.env.INPUT_ARTIFACTS_DIR", include: 'strong/*/jars/*.jar')
}

version = "$System.env.PACKAGE_CUMULATIVE_VERSION"

sourceSets {
    main {
        java {
            srcDir "$System.env.PACKAGE_DIR/src"
        }
        resources {
            srcDir "$System.env.PACKAGE_DIR/src"
        }
    }
    test {
        java {
            srcDir "$System.env.PACKAGE_DIR/test"
        }
        resources {
            srcDir "$System.env.PACKAGE_DIR/test"
        }
    }
}

jar {
    File resourceDir = file("$buildDir/version-resources/META-INF")
    resourceDir.mkdirs()
    File qbtDir = file(resourceDir.toPath().resolve('qbt'))
    qbtDir.mkdirs()
    File versionFile = file(qbtDir.toPath().resolve('version'))
    versionFile.text = "$System.env.PACKAGE_CUMULATIVE_VERSION"
    into ('/META-INF') {
        from fileTree(resourceDir)
    }
}

task simplePublishJars(type: Copy) {
    from jar
    into "$System.env.OUTPUT_ARTIFACTS_DIR/jars"
}

task sourcesJar(type: Jar) {
    from sourceSets.main.allSource
    from sourceSets.test.allSource
}

task simplePublishSources(type: Copy) {
    from sourcesJar
    into "$System.env.OUTPUT_ARTIFACTS_DIR/sources"
}

task simplePublish {
    dependsOn simplePublishJars, simplePublishSources
}
